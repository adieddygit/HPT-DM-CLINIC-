 <!-- <nav class="tabpage" id="tabpage_2">
                    <p>Appointment form goes here</p>
                    <div class="container-fluid">
                        <h1 class="mt-4">Book Appointment</h1>
                        <h3></h3>
                        <div class="msg">{{ msg }}</div>
                        {% if appointment %}
                        <form action="/update_appointment" method="POST" class="appointment-form">
                            <div class="form-group">
                                <label for="name">Username</label>
                                <input type="text" id="username" name="username" placeholder="Enter your username" required>
                            </div>
                    
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" placeholder="Enter your email" required>
                            </div>
                    
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>
                            </div>
                    
                            <div class="form-group">
                                <label for="appointment_date">Preferred Date</label>
                                <input type="date" id="appointment_date" name="appointment_date" required>
                            </div>
                    
                            <div class="form-group">
                                <label for="appointment_time">Preferred Time</label>
                                <input type="time" id="appointment_time" name="appointment_time" required>
                            </div>
                    
                            <div class="form-group">
                                <label for="purpose">Purpose of Appointment</label>
                                <select id="purpose" name="purpose" required>
                                    <option value="">Select purpose</option>
                                    <option value="consultation">Consultation</option>
                                    <option value="checkup">Health Checkup</option>
                                    <option value="followup">Follow-up</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                    
                            <div class="form-group">
                                <label for="message">Additional Information</label>
                                <textarea id="message" name="message" rows="4" placeholder="Enter any additional information (optional)"></textarea>
                            </div>
                    
                            <button type="submit" class="appointment-btn">Submit</button>
                        </form>
                            {% else %}
                            <p>No appointment available.</p>
                        {% endif %}    
                </nav>
            
                <div id="tabscontent">
                    
                    <nav class="tabpage" id="tabpage_3">
                        <p></p>
                        <div class="container-fluid">
                            <h1 class="mt-4">Patient Health Metrics</h1>
                            <h3>Health Records</h3>
                            <div class="msg">{{ msg }}</div>
                            {% if patient_health_metrics %}
                            <form action="/update_metrics" method="post">
                                <div class="row">
                                    <div class="col-5">
                                        <label for="recorded_date">Date of Record</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="date" name="recorded_date" id="recorded_date" value="{{ patient_health_metrics.recorded_date }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="patient_id">Client ID</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="patient_id" id="patient_id" value="{{ patient_health_metrics.patient_id }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="health_care_facility">Health Care Facility</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="health_care_facility" id="health_care_facility" value="{{ patient_health_metrics.health_care_facility }}">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="provider_name">Provider Name</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="provider_name" id="provider_name" value="{{ patient_health_metrics.provider_name }}">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="provider_contact">Health Provider's Contact</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="provider_contact" id="provider_contact" value="{{ patient_health_metrics.provider_contact }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="vitals">Vital Signs</label>
                                    </div>
                                    <div class="col-7">
                                        Weight: <input type="text" name="weight" value="{{ patient_health_metrics.weight }}"><br/>
                                        Height: <input type="text" name="height" value="{{ patient_health_metrics.height }}"><br/>
                                        Blood Pressure: <input type="text" name="blood_pressure" value="{{ patient_health_metrics.blood_pressure }}"><br/>
                                        Blood Sugar: <input type="text" name="blood_sugar" value="{{ patient_health_metrics.blood_sugar }}"><br/>
                                        Temperature: <input type="text" name="temperature" value="{{ patient_health_metrics.temperature }}"><br/>
                                        Respiration: <input type="text" name="respiration" value="{{ patient_health_metrics.respiration }}"><br/>
                                        Pulse: <input type="text" name="pulse" value="{{ patient_health_metrics.pulse }}"><br/>
                                        Oxygen Saturation: <input type="text" name="spo2" value="{{ patient_health_metrics.spo2 }}"><br/>
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="urine_ketones">Urine Ketones</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="radio" name="urine_ketones" value="Nill" {% if patient_health_metrics.urine_ketones == 'Nill' %}checked{% endif %}> Nill<br/>
                                        <input type="radio" name="urine_ketones" value="1+" {% if patient_health_metrics.urine_ketones == '1+' %}checked{% endif %}> 1+<br/>
                                        <input type="radio" name="urine_ketones" value="2+" {% if patient_health_metrics.urine_ketones == '2+' %}checked{% endif %}> 2+<br/>
                                        <input type="radio" name="urine_ketones" value="3+" {% if patient_health_metrics.urine_ketones == '3+' %}checked{% endif %}> 3+<br/>
                                        <input type="radio" name="urine_ketones" value="No test" {% if patient_health_metrics.urine_ketones == 'No test' %}checked{% endif %}> No test<br/>
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="lab_investigation_result">Laboratory Investigation</label>
                                    </div>
                                    <div class="input-group">
                                        <input type="text" name="lab_investigation_type[]" placeholder="Enter Investigation" required>
                                        <input type="text" name="lab_investigation_result[]" placeholder="Enter Result" required>
                                        <button type="button" id="add-more">Add Another</button>
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="radiograph_investigation_type">Radiographic Investigation</label>
                                    </div>
                                    <div class="input-group">
                                        <input type="text" name="radiograph_investigation_type[]" placeholder="Enter Investigation" required>
                                        <input type="text" name="radiograph_investigation_result[]" placeholder="Enter Result" required>
                                        <button type="button" id="add-more">Add Another</button>
                                    </div>
                                </div>
                                <hr/>
                                <div class="form-group">
                                    <label for="heart_conditions">Heart Conditions</label>
                                    <input type="text" class="form-control" id="heart_conditions" name="heart_conditions" value="{{ patient_health_metrics.heart_conditions }}">
                                </div>
                                <hr/>
                                <div class="form-group">
                                    <label for="diagnosis">Diagnosis</label>
                                    <input type="text" class="form-control" id="diagnosis" name="diagnosis" value="{{ patient_health_metrics.diagnosis }}">
                                </div>
                                <hr/>
                                <div class="form-group">
                                    <label for="hospitalized_for_hpt_dm">Has client been hospitalized for HPT/DM?</label>
                                    <input type="text" class="form-control" id="hospitalized_for_hpt_dm" name="hospitalized_for_hpt_dm" value="{{ patient_health_metrics.hospitalized_for_hpt_dm }}">
                                </div>
                                <hr/>
                                <div class="form-group">
                                    <label for="complications">Any Complications</label>
                                    <input type="text" class="form-control" id="complications" name="complications" value="{{ patient_health_metrics.complications }}">
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="notes">Add Note</label>
                                    </div>
                                    <div class="col-7">
                                        <div class="form-group">
                                            <label for="message">Additional Information</label>
                                            <textarea id="message" name="message" rows="4" placeholder="Enter any additional information (optional)">{{ patient_health_metrics.notes }}</textarea>
                                        </div>
                                    </div>
                                </div>
                                <input type="submit" value="Submit" class="btn btn-danger">
                            </form>
                            {% else %}
        <p>No health metrics available.</p>
    {% endif %}
                        </div>
                    </nav>
    
                   
                    <nav class="tabpage" id="tabpage_4">
                        <p></p>
                        <div class="container-fluid">
                            <h1 class="mt-4">Patient Treatment</h1>
                            <h3>Treatment Types</h3>
                            <div class="msg">{{ msg }}</div>
                            <form action="/update_treatment" method="post">
                                <div class="row">
                                    <div class="col-5">
                                        <label for="date_of_treatment">Date of Treatment</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="date" name="date_of_treatment" id="date_of_treatment" value="{{ patient_treatment.date_of_treatment }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="patient_id">Client ID</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="patient_id" id="patient_id" value="{{ patient_treatment.patient_id }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="health_care_facility">Health Care Facility</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="health_care_facility" id="health_care_facility" value="{{ patient_treatment.health_care_facility }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="provider_type">Health Care Provider</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="provider_type" id="provider_type" value="{{ patient_treatment.provider_type }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="provider_contact">Provider Contact</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="provider_contact" id="provider_contact" value="{{ patient_treatment.provider_contact }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="treatment_type">Treatment Type</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="treatment_type" id="treatment_type" value="{{ patient_treatment.treatment_type }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="treatment_plan">Treatment Plan</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="treatment_plan" id="treatment_plan" value="{{ patient_treatment.treatment_plan }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="defaulted_treatment">Has client defaulted treatment?</label>
                                    </div>
                                    <div class="col-7">
                                        <input type="text" name="defaulted_treatment" id="defaulted_treatment" value="{{ patient_treatment.defaulted_treatment }}">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-5">
                                        <label for="treatment_notes">Add Note</label>
                                    </div>
                                    <div class="col-7">
                                        <div class="form-group">
                                            <label for="treatment_notes">Treatment Notes</label>
                                            <textarea id="treatment_notes" name="treatment_notes" rows="4" placeholder="Enter any additional information (optional)">{{ patient_treatment.treatment_notes }}</textarea>
                                        </div>
                                    </div>
                                </div>
                                <input type="submit" value="Submit" class="btn btn-danger">
                            </form>
                        </div>
                    </nav>
                </div>
            </div>
        </div> -->
    </div>

    @app.route('/sign_up', methods=['GET', 'POST'])
def sign_up():
    msg = ''
    if request.method == 'POST' and 'username' in request.form and 'password' in request.form:
        result = request.form
        
        # Get the form values
        username = result['username']
        email = result['email'].lower()
        role = result['role']
        
        # Check if passwords match
        password = result['password']
        cpassword = result['cpassword']
        if password != cpassword:
            msg = 'Passwords do not match'
            flash(msg, 'error')
            return render_template('sign_up.html', msg=msg)
        
        # Check if the username already exists in the database
        with engine.connect() as con:
            result = con.execute(text("SELECT * FROM user WHERE username = :username"), {"username": username})
            account = result.fetchone()
        
        if account:
            msg = 'Account already exists!'
            flash(msg, 'error')
            return render_template('sign_up.html', msg=msg)
        
        if not username or not password:
            msg = 'Please fill out the form'
            flash(msg, 'error')
            return render_template('sign_up.html', msg=msg)
        
        # Hash the password
        hash_string = password + app.config['SECRET_KEY']
        password_hashed = hashlib.sha256(hash_string.encode()).hexdigest()

        # Insert the new user into the database
        try:
            with engine.connect() as con:
                con.execute(text("INSERT INTO user (username, email, password, role) VALUES (:username, :email, :password, :role)"),
                            {"username": username, "email": email, "password": password_hashed, "role": role})
            msg = 'Account created successfully'
            flash(msg, 'success')
            return redirect(url_for('login'))
        
        except Exception as e:
            print(f"Error during sign-up: {e}")
            msg = 'There was an issue creating your account'
            flash(msg, 'error')
    
    return render_template('sign_up.html', msg=msg)

# return render_template('response.html', result=result)



@app.route('/login', methods=['GET', 'POST'])
def login():
    msg = ''
    if request.method == 'POST' and 'username' in request.form and 'password' in request.form:
        # Get the form values
        username = request.form['username']
        password_entered = request.form['password']
        
        # Hash the password entered by the user
        hash = password_entered + app.config['SECRET_KEY']
        hash = hashlib.sha256(hash.encode())
        password = hash.hexdigest()
        
        # Temporary debug print statements
        print("Entered password (before hash):", password_entered)
        print("Hash after combining with secret key:", password)
        
        # Check if the user exists in the database
        with engine.connect() as con:
            result = con.execute(text("SELECT * FROM user WHERE username = :username AND password = :password"),
                                 {"username": username, "password": password})
            account = result.fetchone()

        # Verify if the account exists
        if account:
            msg = f'You are welcome {username}'
            flash(msg, 'success')
            return redirect(url_for('home', msg=msg))
        else:
            msg = 'Incorrect username or password!'
            flash(msg, 'error')
    
    return render_template('login.html', msg=msg)
